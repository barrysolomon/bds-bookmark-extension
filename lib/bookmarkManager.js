
class ColumnIndex {
    static LINK = 0;
    static DESCRIPTION = 1;
    static OPTIONS = 2;
    static ACTIONS = 3;
}

function loadBookmarksFromStorage() {
    chrome.storage.sync.get({ bookmarks: [] }, function (result) {
        var bookmarks = result.bookmarks;
        bookmarks.forEach(bookmark => bookmarkManager.addBookmarkToTable(bookmark));
    });
}

function deleteBookmarkFromStorage(bookmark, row) {
    chrome.storage.sync.get({ bookmarks: [] }, function (result) {
        var bookmarks = result.bookmarks;
        var index = bookmarks.findIndex(b => b.url === bookmark.url);
        if (index > -1) {
            bookmarks.splice(index, 1);
            chrome.storage.sync.set({ bookmarks: bookmarks }, function () {
                row.remove();
            });
        }
    });
}

function deleteQueryParamAndOptionTag(event) {

    var bookmarkId = event.target.dataset.bookmarkId;
    var bookmarkUrl = document.getElementById(bookmarkId)?.href;

    if (typeof bookmarkUrl === 'string') {
        var parsedUrl = new URL(bookmarkUrl);
        parsedUrl.searchParams.delete(event.target.parentElement.textContent.slice(0, -1)); // Deleting the parameter from the URL

        // Update the URL in the bookmark link
        document.getElementById(bookmarkId).href = parsedUrl.toString();
    }

    // Remove the option tag
    event.target.parentElement.remove();

    // Update the URL in the storage
    chrome.storage.sync.get({ bookmarks: [] }, function (result) {
        var bookmarks = result.bookmarks;
        var index = bookmarks.findIndex(b => b.url === bookmarkUrl);
        if (index > -1) {
            bookmarks[index].url = parsedUrl.toString();
            chrome.storage.sync.set({ bookmarks: bookmarks });
        }
    });

}

function parseURLForShortName(url) {
    var parsedUrl = new URL(url);
    return parsedUrl.hostname;
}

class BookmarkManager {

    constructor(tableId) {
        this.table = document.getElementById(tableId).getElementsByTagName('tbody')[0];
    }

    addBookmarkFromPage() {
        chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
            var tab = tabs[0];
            if (tab.url.startsWith('https://platform.lumigo.io')) {
                var bookmark = {
                    url: tab.url,
                    shortName: tab.title, // parseURLForShortName(tab.url),
                    name: '', // Name will be empty string, adjust this if you can get the name somehow
                    description: tab.title // Description will be the title of the page
                };

                chrome.storage.sync.get({ bookmarks: [] }, function (result) {
                    var bookmarks = result.bookmarks;
                    // Prevent duplicates
                    if (bookmarks.findIndex(b => b.url === bookmark.url) === -1) {
                        bookmarks.push(bookmark);
                        // Only add the bookmark to the table after it's saved to storage
                        chrome.storage.sync.set({ bookmarks: bookmarks }, function () {
                            bookmarkManager.addBookmarkToTable(bookmark);
                        });
                    }
                });
            } else {
                alert('This extension only works on pages under the domain platform.lumigo.io.');
            }
        });
    }

    addBookmarkToTable(bookmark) {

        const row = this.table.insertRow(-1);

        const cell2 = row.insertCell(ColumnIndex.LINK);
        const cell3 = row.insertCell(ColumnIndex.DESCRIPTION);
        const cell4 = row.insertCell(ColumnIndex.OPTIONS);
        const cell5 = row.insertCell(ColumnIndex.ACTIONS);

        // Parse the query string of the URL
        const parsedUrl = new URL(bookmark.url);

        // ICON
        var img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05778 18.943L4.02311 12.4656L4 6.00001H7.6376H11.2752V7.19739V8.39477H9.02348H6.77176V9.87716V11.3595H8.85043H10.9291V12.5569V13.7543H8.85043H6.77176L6.74864 16.3431L6.71398 18.943H5.38588H4.05778ZM13.585 11.8728C12.8225 10.6298 12.1991 9.60357 12.1991 9.58074C12.1991 9.55792 12.8803 9.5351 13.7005 9.5351H15.2017L15.9176 10.9604C16.3218 11.7473 16.6682 12.3858 16.7028 12.3858C16.7375 12.3858 17.0723 11.7473 17.4418 10.9604L18.1231 9.5351H19.5433C20.3286 9.5351 20.9754 9.56933 20.9754 9.61498C20.9754 9.66612 20.4743 10.4775 19.8383 11.5074C19.7647 11.6266 19.6893 11.7486 19.6127 11.8728L18.2499 14.0279L19.6473 16.4569C20.4326 17.7912 21.0332 18.9087 20.9986 18.943C20.9636 18.9772 20.2939 19 19.5087 19H18.0884L17.3032 17.4377L16.5064 15.8869L16.056 16.8446C15.8136 17.3693 15.4784 18.0534 15.317 18.3727L15.0283 18.943L13.6193 18.9772C12.6148 19 12.1991 18.9658 12.1991 18.8745C12.1991 18.806 12.8228 17.7228 13.585 16.4683C14.3471 15.2253 14.9709 14.1763 14.9709 14.1534C14.9709 14.1306 14.3471 13.1044 13.585 11.8728Z" fill="currentColor"></path></svg>';
        img_src = '<a id="' + bookmark.id + '" href="' + bookmark.url + '" target="_blank"><img src="http://www.google.com/s2/favicons?domain=' + bookmark.url + '" /></a>';

        do {
            if ((bookmark.url.includes("dashboard"))) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.672 9.393C13.672 9.94529 14.1197 10.393 14.672 10.393H20C20.5523 10.393 21 9.94528 21 9.393V5C21 4.44771 20.5523 4 20 4H14.672C14.1197 4 13.672 4.44772 13.672 5V9.393ZM15.196 8.86901H19.475V5.52501H15.196V8.86901ZM4 13.262C4 13.8143 4.44772 14.262 5 14.262H10.328C10.8803 14.262 11.328 13.8143 11.328 13.262V5C11.328 4.44772 10.8803 4 10.328 4H5C4.44771 4 4 4.44772 4 5V13.262ZM5.52501 12.739H9.80401V5.52501H5.52501V12.739ZM13.672 20C13.672 20.5523 14.1197 21 14.672 21H20C20.5523 21 21 20.5523 21 20V12.738C21 12.1857 20.5523 11.738 20 11.738H14.672C14.1197 11.738 13.672 12.1857 13.672 12.738V20ZM15.196 19.476H19.475V13.262H15.196V19.476ZM4 20C4 20.5523 4.44772 21 5 21H10.328C10.8803 21 11.328 20.5523 11.328 20V16.606C11.328 16.0537 10.8803 15.606 10.328 15.606H5C4.44771 15.606 4 16.0537 4 16.606V20ZM5.52501 19.476H9.80401V17.132H5.52501V19.476Z" fill="currentColor"></path></svg>';
                break;
            }
            if ((bookmark.url.includes("issues"))) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05778 18.943L4.02311 12.4656L4 6.00001H7.6376H11.2752V7.19739V8.39477H9.02348H6.77176V9.87716V11.3595H8.85043H10.9291V12.5569V13.7543H8.85043H6.77176L6.74864 16.3431L6.71398 18.943H5.38588H4.05778ZM13.585 11.8728C12.8225 10.6298 12.1991 9.60357 12.1991 9.58074C12.1991 9.55792 12.8803 9.5351 13.7005 9.5351H15.2017L15.9176 10.9604C16.3218 11.7473 16.6682 12.3858 16.7028 12.3858C16.7375 12.3858 17.0723 11.7473 17.4418 10.9604L18.1231 9.5351H19.5433C20.3286 9.5351 20.9754 9.56933 20.9754 9.61498C20.9754 9.66612 20.4743 10.4775 19.8383 11.5074C19.7647 11.6266 19.6893 11.7486 19.6127 11.8728L18.2499 14.0279L19.6473 16.4569C20.4326 17.7912 21.0332 18.9087 20.9986 18.943C20.9636 18.9772 20.2939 19 19.5087 19H18.0884L17.3032 17.4377L16.5064 15.8869L16.056 16.8446C15.8136 17.3693 15.4784 18.0534 15.317 18.3727L15.0283 18.943L13.6193 18.9772C12.6148 19 12.1991 18.9658 12.1991 18.8745C12.1991 18.806 12.8228 17.7228 13.585 16.4683C14.3471 15.2253 14.9709 14.1763 14.9709 14.1534C14.9709 14.1306 14.3471 13.1044 13.585 11.8728Z" fill="currentColor"></path></svg>';
                break;
            }
            if ((bookmark.url.includes("functions"))) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05778 18.943L4.02311 12.4656L4 6.00001H7.6376H11.2752V7.19739V8.39477H9.02348H6.77176V9.87716V11.3595H8.85043H10.9291V12.5569V13.7543H8.85043H6.77176L6.74864 16.3431L6.71398 18.943H5.38588H4.05778ZM13.585 11.8728C12.8225 10.6298 12.1991 9.60357 12.1991 9.58074C12.1991 9.55792 12.8803 9.5351 13.7005 9.5351H15.2017L15.9176 10.9604C16.3218 11.7473 16.6682 12.3858 16.7028 12.3858C16.7375 12.3858 17.0723 11.7473 17.4418 10.9604L18.1231 9.5351H19.5433C20.3286 9.5351 20.9754 9.56933 20.9754 9.61498C20.9754 9.66612 20.4743 10.4775 19.8383 11.5074C19.7647 11.6266 19.6893 11.7486 19.6127 11.8728L18.2499 14.0279L19.6473 16.4569C20.4326 17.7912 21.0332 18.9087 20.9986 18.943C20.9636 18.9772 20.2939 19 19.5087 19H18.0884L17.3032 17.4377L16.5064 15.8869L16.056 16.8446C15.8136 17.3693 15.4784 18.0534 15.317 18.3727L15.0283 18.943L13.6193 18.9772C12.6148 19 12.1991 18.9658 12.1991 18.8745C12.1991 18.806 12.8228 17.7228 13.585 16.4683C14.3471 15.2253 14.9709 14.1763 14.9709 14.1534C14.9709 14.1306 14.3471 13.1044 13.585 11.8728Z" fill="currentColor"></path></svg>';
                break;
            }
            if ((bookmark.url.includes("ecs/clusters"))) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.9281 14.6856L16.839 13.0697V10.064C16.839 9.88138 16.7436 9.71146 16.5861 9.61542L13.5955 7.79064V5.47087L18.9281 8.58008V14.6856ZM19.7374 7.82547L13.3329 4.09041C13.1678 3.99437 12.9609 3.99226 12.7937 4.08619C12.6276 4.18012 12.5236 4.35426 12.5236 4.54423V8.08404C12.5236 8.26662 12.6201 8.43654 12.7766 8.53258L15.7671 10.3574V13.3262C15.7671 13.4877 15.8432 13.6407 15.9729 13.741L19.1328 16.1874C19.2293 16.2623 19.3451 16.3003 19.4641 16.3003C19.5434 16.3003 19.6238 16.2824 19.6977 16.2465C19.8821 16.1589 20 15.9742 20 15.7726V8.27929C20 8.09248 19.9003 7.9194 19.7374 7.82547ZM12.037 19.8939L5.07188 16.3995V8.57902L10.3863 5.45715V7.77797L7.46433 9.59959C7.30998 9.69669 7.21565 9.86449 7.21565 10.046V14.8977C7.21565 15.0982 7.33034 15.2808 7.51363 15.3705L11.7401 17.4328C11.8901 17.5066 12.0691 17.5045 12.2203 17.4296L15.5378 15.7673L17.7662 17.6164L12.037 19.8939ZM15.9558 14.7352C15.7929 14.599 15.5581 14.5737 15.3673 14.6687L11.9737 16.3689L8.28753 14.5705V10.3352L11.2084 8.51359C11.3638 8.41649 11.4582 8.24868 11.4582 8.06715V4.5284C11.4582 4.33843 11.3542 4.16323 11.187 4.0693C11.0176 3.97432 10.8107 3.97748 10.6478 4.07564L4.26154 7.82547C4.09969 7.92045 4 8.09248 4 8.27929V16.7225C4 16.9209 4.11255 17.1024 4.29262 17.1921L11.7679 20.943C11.843 20.981 11.9266 21 12.0113 21C12.0788 21 12.1463 20.9873 12.2117 20.962L18.9935 18.2676C19.1671 18.1979 19.2926 18.0438 19.3226 17.8602C19.3515 17.6776 19.2818 17.4929 19.1382 17.3737L15.9558 14.7352Z" fill="currentColor"></path></svg>';
                break;
            }
            if ((bookmark.url.includes("transactions"))) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.3307 18.5406C17.6617 18.5406 17.1167 17.9956 17.1167 17.3267C17.1167 16.6567 17.6617 16.1117 18.3307 16.1117C19.0007 16.1117 19.5457 16.6567 19.5457 17.3267C19.5457 17.9956 19.0007 18.5406 18.3307 18.5406ZM12.5028 4.45796C13.1728 4.45796 13.7168 5.00195 13.7168 5.67093C13.7168 6.34092 13.1728 6.88591 12.5028 6.88591C11.8329 6.88591 11.2889 6.34092 11.2889 5.67093C11.2889 5.00195 11.8329 4.45796 12.5028 4.45796ZM12.5028 11.2558C13.1728 11.2558 13.7168 11.8008 13.7168 12.4708C13.7168 13.1398 13.1728 13.6847 12.5028 13.6847C11.8329 13.6847 11.2889 13.1398 11.2889 12.4708C11.2889 11.8008 11.8329 11.2558 12.5028 11.2558ZM7.88898 17.3267C7.88898 17.9956 7.34399 18.5406 6.67401 18.5406C6.00403 18.5406 5.46004 17.9956 5.46004 17.3267C5.46004 16.6567 6.00403 16.1117 6.67401 16.1117C7.34399 16.1117 7.88898 16.6567 7.88898 17.3267ZM19.9087 15.1667C18.9617 14.4737 17.6628 14.4907 16.7338 15.1847L14.9948 13.4458C15.2728 12.7378 15.2388 11.9548 14.8948 11.2698C14.5548 10.5928 13.9558 10.1018 13.2349 9.89884V8.24088C14.4758 7.89188 15.2938 6.70591 15.1628 5.40294C15.0238 4.03298 13.8829 3 12.5079 3C11.1319 3 9.98994 4.03298 9.85195 5.40294C9.71995 6.70591 10.5389 7.89188 11.7789 8.24088V9.89984C11.0619 10.1048 10.4659 10.5958 10.1279 11.2698C9.78495 11.9528 9.74895 12.7338 10.0229 13.4388L8.28198 15.1827C7.26201 14.4137 5.83504 14.4677 4.87506 15.3457C3.85709 16.2727 3.70809 17.8097 4.52907 18.9156C5.05106 19.6216 5.85404 20.0006 6.67402 20.0006C7.14201 20.0006 7.614 19.8776 8.04399 19.6216C9.17796 18.9456 9.64295 17.5637 9.16796 16.3517L10.9079 14.6117C11.8519 15.3167 13.1539 15.3167 14.0988 14.6117L15.8398 16.3547C15.7218 16.6637 15.6588 16.9957 15.6588 17.3257L15.6648 17.6107L15.6798 17.6077C15.8038 18.7396 16.6468 19.6946 17.7778 19.9346C18.9997 20.1996 20.2587 19.5556 20.7697 18.4126C21.2807 17.2697 20.9187 15.9057 19.9087 15.1667Z" fill="currentColor"></path></svg>';
                break;
            }
            if (bookmark.url.includes("live-tail")) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2943 10.6347C14.0071 11.3888 14.0071 12.6114 13.2943 13.3656C12.5806 14.1197 11.4241 14.1197 10.7104 13.3656C9.99755 12.6114 9.99755 11.3888 10.7104 10.6347C11.4241 9.88056 12.5806 9.88056 13.2943 10.6347ZM8.82655 7.97751C9.16585 8.33778 9.16495 8.92017 8.82565 9.27763C8.13805 10.0065 7.76005 10.9716 7.76005 11.9992C7.76005 13.0277 8.13805 13.9946 8.82565 14.7217C9.16495 15.0801 9.16585 15.6625 8.82655 16.0218C8.65735 16.2019 8.43505 16.2924 8.21275 16.2924C7.98955 16.2924 7.76905 16.2028 7.59805 16.0227C6.58195 14.9485 6.02305 13.5196 6.02305 11.9992C6.02305 10.4788 6.58195 9.05176 7.59805 7.97658C7.93825 7.61819 8.48815 7.61912 8.82655 7.97751ZM16.4009 7.97658C17.417 9.05176 17.9768 10.4788 17.9768 11.9992C17.9768 13.5196 17.417 14.9485 16.4009 16.0227C16.2317 16.2028 16.0103 16.2924 15.788 16.2924C15.5657 16.2924 15.3434 16.2019 15.1733 16.0218C14.8349 15.6625 14.8349 15.0801 15.1742 14.7217C15.8627 13.9946 16.2407 13.0277 16.2407 11.9992C16.2407 10.9716 15.8627 10.0065 15.1742 9.27763C14.8349 8.92017 14.8349 8.33778 15.1733 7.97751C15.5117 7.61912 16.0616 7.61819 16.4009 7.97658ZM6.8628 5.26996C7.2021 5.62929 7.2012 6.21168 6.8628 6.57101C5.4912 8.02045 4.7361 9.94868 4.7361 12.0001C4.7361 14.0506 5.4912 15.9789 6.8628 17.4292C7.2012 17.7876 7.2021 18.37 6.8628 18.7303C6.6945 18.9095 6.4713 19 6.249 19C6.0267 19 5.8062 18.9104 5.6361 18.7312C3.9369 16.9327 3 14.5425 3 12.0001C3 9.45683 3.9369 7.0666 5.6361 5.26903C5.9754 4.9097 6.5253 4.91064 6.8628 5.26996ZM18.3649 5.26903C20.0632 7.0666 21.0001 9.45683 21.0001 12.0001C21.0001 14.5425 20.0632 16.9336 18.3649 18.7312C18.1939 18.9104 17.9734 19 17.7511 19C17.5288 19 17.3065 18.9095 17.1373 18.7303C16.798 18.37 16.7989 17.7876 17.1382 17.4292C18.5098 15.9789 19.2649 14.0506 19.2649 12.0001C19.2649 9.94962 18.5098 8.02138 17.1382 6.57101C16.7989 6.21168 16.798 5.63022 17.1373 5.26996C17.4757 4.91064 18.0256 4.9097 18.3649 5.26903Z" fill="currentColor"></path></svg>';
                break;
            }
            if (bookmark.url.includes("explore")) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7446 15.4965C12.2645 15.6345 11.7655 15.7036 11.2615 15.7036H11.2515C8.3924 15.7006 6.00031 13.4625 5.8053 10.6064C5.61129 7.75126 7.67737 5.20816 10.5095 4.81615C10.7595 4.78215 11.0085 4.76515 11.2545 4.76515C13.7986 4.76515 16.0717 6.55921 16.6057 9.11231C17.1917 11.9134 15.4947 14.7175 12.7446 15.4965ZM20.7549 18.5007L16.9287 14.6585C18.9588 12.0394 18.9648 8.42628 16.9167 5.79519C14.8236 3.10409 11.2095 2.24506 8.13039 3.70611C5.05228 5.16616 3.42922 8.50929 4.18325 11.8334C4.93527 15.1495 7.82738 17.4586 11.2215 17.4586C11.9085 17.4836 12.5666 17.3706 13.2206 17.1876C14.1196 16.9286 14.9436 16.5036 15.6737 15.9246L19.4868 19.7407C19.6508 19.9057 19.8768 20.0007 20.1098 20.0007C20.3418 20.0007 20.5689 19.9057 20.7279 19.7457C20.8959 19.5857 20.9949 19.3607 20.9999 19.1277C21.0039 18.8927 20.9169 18.6697 20.7549 18.5007Z" fill="currentColor"></path></svg>';
                break;
            }
            if ((bookmark.url.includes("appsync"))) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><rect width="24" height="24" fill="none"></rect><path d="M17.6164 17.5982V15.8814C17.6164 15.7128 17.5484 15.5511 17.4273 15.4318C17.3062 15.3126 17.142 15.2456 16.9708 15.2456H12.7743V14.6097C13.3682 14.4553 13.8847 14.0932 14.2273 13.5911C14.57 13.089 14.7154 12.4812 14.6363 11.8813C14.5572 11.2814 14.2591 10.7303 13.7976 10.331C13.3362 9.9317 12.7429 9.71149 12.1286 9.71149C11.5144 9.71149 10.9211 9.9317 10.4596 10.331C9.99818 10.7303 9.70007 11.2814 9.621 11.8813C9.54192 12.4812 9.68729 13.089 10.0299 13.5911C10.3726 14.0932 10.8891 14.4553 11.483 14.6097V15.2774H7.28649C7.11526 15.2774 6.95104 15.3444 6.82996 15.4636C6.70889 15.5829 6.64087 15.7446 6.64087 15.9132V17.5876C6.31496 17.7296 6.03894 17.9633 5.84749 18.2593C5.65604 18.5554 5.5577 18.9005 5.56483 19.2514C5.56483 19.481 5.61075 19.7084 5.69998 19.9206C5.7892 20.1327 5.91998 20.3255 6.08485 20.4878C6.24972 20.6502 6.44544 20.779 6.66085 20.8669C6.87626 20.9548 7.10713 21 7.34029 21C7.57344 21 7.80432 20.9548 8.01973 20.8669C8.23513 20.779 8.43086 20.6502 8.59573 20.4878C8.76059 20.3255 8.89137 20.1327 8.9806 19.9206C9.06982 19.7084 9.11574 19.481 9.11574 19.2514C9.10427 18.8881 8.98645 18.5358 8.77646 18.2369C8.56648 17.9379 8.27327 17.7051 7.93211 17.5664V16.5067H11.483V17.5664C11.1521 17.7042 10.869 17.9339 10.6684 18.2275C10.4678 18.5211 10.3582 18.8658 10.3532 19.2196C10.3518 19.5381 10.4388 19.8509 10.6047 20.1243C10.7706 20.3976 11.0092 20.6212 11.2947 20.7708C11.5802 20.9204 11.9018 20.9903 12.2247 20.9731C12.5476 20.9559 12.8596 20.8521 13.127 20.673C13.3944 20.4939 13.6071 20.2463 13.742 19.9569C13.877 19.6675 13.9292 19.3473 13.8929 19.0308C13.8566 18.7143 13.7332 18.4136 13.536 18.1611C13.3389 17.9087 13.0755 17.714 12.7743 17.5982V16.5385H16.3252V17.5982C15.9396 17.7464 15.6188 18.0227 15.4181 18.3792C15.2174 18.7357 15.1494 19.15 15.226 19.5506C15.3026 19.9512 15.5188 20.3128 15.8374 20.573C16.156 20.8333 16.5569 20.9757 16.9708 20.9757C17.3847 20.9757 17.7856 20.8333 18.1042 20.573C18.4228 20.3128 18.639 19.9512 18.7156 19.5506C18.7922 19.15 18.7242 18.7357 18.5235 18.3792C18.3228 18.0227 18.002 17.7464 17.6164 17.5982ZM7.7707 19.2196C7.7707 19.3139 7.7423 19.4061 7.6891 19.4846C7.63589 19.563 7.56027 19.6241 7.47179 19.6602C7.38331 19.6963 7.28595 19.7057 7.19202 19.6873C7.09809 19.6689 7.01181 19.6235 6.94409 19.5568C6.87637 19.4901 6.83026 19.4052 6.81157 19.3127C6.79289 19.2202 6.80248 19.1243 6.83913 19.0371C6.87578 18.95 6.93784 18.8755 7.01747 18.8231C7.0971 18.7707 7.19072 18.7427 7.28649 18.7427C7.41491 18.7427 7.53807 18.793 7.62888 18.8824C7.71969 18.9718 7.7707 19.0931 7.7707 19.2196ZM17.455 19.2196C17.455 19.3139 17.4266 19.4061 17.3734 19.4846C17.3202 19.563 17.2446 19.6241 17.1561 19.6602C17.0676 19.6963 16.9703 19.7057 16.8763 19.6873C16.7824 19.6689 16.6961 19.6235 16.6284 19.5568C16.5607 19.4901 16.5146 19.4052 16.4959 19.3127C16.4772 19.2202 16.4868 19.1243 16.5234 19.0371C16.5601 18.95 16.6222 18.8755 16.7018 18.8231C16.7814 18.7707 16.875 18.7427 16.9708 18.7427C17.0992 18.7427 17.2224 18.793 17.3132 18.8824C17.404 18.9718 17.455 19.0931 17.455 19.2196ZM12.6667 19.2196C12.6667 19.3139 12.5845 19.4061 12.5313 19.4846C12.478 19.563 12.4024 19.6241 12.3139 19.6602C12.2255 19.6963 12.1281 19.7057 12.0342 19.6873C11.9402 19.6689 11.854 19.6235 11.7862 19.5568C11.7185 19.4901 11.6724 19.4052 11.6537 19.3127C11.635 19.2202 11.6446 19.1243 11.6813 19.0371C11.7179 18.95 11.78 18.8755 11.8596 18.8231C11.9393 18.7707 12.0329 18.7427 12.1286 18.7427C12.1966 18.7353 12.2654 18.742 12.3305 18.7626C12.3956 18.7832 12.4555 18.8172 12.5064 18.8622C12.5572 18.9073 12.5978 18.9624 12.6254 19.024C12.653 19.0856 12.6671 19.1523 12.6667 19.2196ZM10.8912 12.1723C10.8912 11.9313 10.9638 11.6957 11.0997 11.4953C11.2357 11.2948 11.429 11.1386 11.6551 11.0464C11.8812 10.9542 12.13 10.93 12.3701 10.977C12.6101 11.0241 12.8306 11.1401 13.0036 11.3106C13.1767 11.481 13.2946 11.6982 13.3423 11.9346C13.39 12.171 13.3655 12.416 13.2719 12.6387C13.1782 12.8614 13.0196 13.0517 12.8161 13.1856C12.6126 13.3196 12.3734 13.391 12.1286 13.391C11.8005 13.391 11.4857 13.2626 11.2536 13.0341C11.0216 12.8055 10.8912 12.4956 10.8912 12.1723Z" fill="currentColor"></path><path d="M17.186 6.41793C16.6248 5.24785 15.6925 4.2892 14.5297 3.68653C13.3669 3.08386 12.0367 2.86985 10.7397 3.07678C9.44262 3.2837 8.24903 3.90033 7.3389 4.8337C6.42877 5.76706 5.85143 6.96655 5.69395 8.25129C4.87515 8.4116 4.14676 8.86754 3.65175 9.5296C3.15675 10.1917 2.93088 11.012 3.01848 11.8297C3.10609 12.6473 3.50084 13.4032 4.12525 13.9489C4.74966 14.4947 5.55863 14.7908 6.39338 14.7793H6.5225C6.71941 14.7793 6.90826 14.7023 7.0475 14.5651C7.18674 14.428 7.26496 14.242 7.26496 14.0481C7.26496 13.8542 7.18674 13.6682 7.0475 13.531C6.90826 13.3939 6.71941 13.3169 6.5225 13.3169H6.39338C6.13629 13.3361 5.87794 13.3028 5.63452 13.2192C5.3911 13.1355 5.16785 13.0032 4.97876 12.8306C4.78967 12.6579 4.63882 12.4487 4.53565 12.216C4.43249 11.9833 4.37924 11.7321 4.37924 11.4782C4.37924 11.2243 4.43249 10.9731 4.53565 10.7404C4.63882 10.5077 4.78967 10.2985 4.97876 10.1258C5.16785 9.95323 5.3911 9.82094 5.63452 9.73726C5.87794 9.65358 6.13629 9.62032 6.39338 9.63955C6.58842 9.63677 6.77452 9.5585 6.91144 9.42167C7.04836 9.28484 7.1251 9.10044 7.12508 8.90833C7.153 7.8579 7.5521 6.84996 8.25361 6.05823C8.95511 5.2665 9.91507 4.74057 10.968 4.57108C12.021 4.40159 13.101 4.59916 14.022 5.12973C14.9429 5.66031 15.6471 6.49066 16.0131 7.47768C16.0689 7.62707 16.1726 7.75447 16.3085 7.84053C16.4445 7.9266 16.6052 7.96664 16.7664 7.95456H16.9278H16.9708C17.7053 7.94606 18.4132 8.22457 18.9396 8.72908C19.466 9.2336 19.7679 9.923 19.7792 10.6463C19.7814 11.2802 19.5623 11.8956 19.1588 12.3894C18.7553 12.8833 18.1918 13.2257 17.5626 13.3593C17.3888 13.4006 17.236 13.5022 17.1323 13.6456C17.0285 13.789 16.9807 13.9644 16.9977 14.1396C17.0147 14.3149 17.0954 14.4782 17.2249 14.5996C17.3543 14.721 17.5239 14.7924 17.7025 14.8005H17.8531C18.8172 14.5355 19.6573 13.9478 20.229 13.1386C20.8006 12.3294 21.068 11.3493 20.9852 10.3669C20.9024 9.38456 20.4746 8.46131 19.7753 7.75604C19.076 7.05077 18.149 6.60758 17.1537 6.50271L17.186 6.41793Z" fill="currentColor"></path></svg>';
                break;
            }
            if ((bookmark.url.includes("api-gateway"))) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><rect width="24" height="24" fill="none"></rect><path d="M17.6164 17.5982V15.8814C17.6164 15.7128 17.5484 15.5511 17.4273 15.4318C17.3062 15.3126 17.142 15.2456 16.9708 15.2456H12.7743V14.6097C13.3682 14.4553 13.8847 14.0932 14.2273 13.5911C14.57 13.089 14.7154 12.4812 14.6363 11.8813C14.5572 11.2814 14.2591 10.7303 13.7976 10.331C13.3362 9.9317 12.7429 9.71149 12.1286 9.71149C11.5144 9.71149 10.9211 9.9317 10.4596 10.331C9.99818 10.7303 9.70007 11.2814 9.621 11.8813C9.54192 12.4812 9.68729 13.089 10.0299 13.5911C10.3726 14.0932 10.8891 14.4553 11.483 14.6097V15.2774H7.28649C7.11526 15.2774 6.95104 15.3444 6.82996 15.4636C6.70889 15.5829 6.64087 15.7446 6.64087 15.9132V17.5876C6.31496 17.7296 6.03894 17.9633 5.84749 18.2593C5.65604 18.5554 5.5577 18.9005 5.56483 19.2514C5.56483 19.481 5.61075 19.7084 5.69998 19.9206C5.7892 20.1327 5.91998 20.3255 6.08485 20.4878C6.24972 20.6502 6.44544 20.779 6.66085 20.8669C6.87626 20.9548 7.10713 21 7.34029 21C7.57344 21 7.80432 20.9548 8.01973 20.8669C8.23513 20.779 8.43086 20.6502 8.59573 20.4878C8.76059 20.3255 8.89137 20.1327 8.9806 19.9206C9.06982 19.7084 9.11574 19.481 9.11574 19.2514C9.10427 18.8881 8.98645 18.5358 8.77646 18.2369C8.56648 17.9379 8.27327 17.7051 7.93211 17.5664V16.5067H11.483V17.5664C11.1521 17.7042 10.869 17.9339 10.6684 18.2275C10.4678 18.5211 10.3582 18.8658 10.3532 19.2196C10.3518 19.5381 10.4388 19.8509 10.6047 20.1243C10.7706 20.3976 11.0092 20.6212 11.2947 20.7708C11.5802 20.9204 11.9018 20.9903 12.2247 20.9731C12.5476 20.9559 12.8596 20.8521 13.127 20.673C13.3944 20.4939 13.6071 20.2463 13.742 19.9569C13.877 19.6675 13.9292 19.3473 13.8929 19.0308C13.8566 18.7143 13.7332 18.4136 13.536 18.1611C13.3389 17.9087 13.0755 17.714 12.7743 17.5982V16.5385H16.3252V17.5982C15.9396 17.7464 15.6188 18.0227 15.4181 18.3792C15.2174 18.7357 15.1494 19.15 15.226 19.5506C15.3026 19.9512 15.5188 20.3128 15.8374 20.573C16.156 20.8333 16.5569 20.9757 16.9708 20.9757C17.3847 20.9757 17.7856 20.8333 18.1042 20.573C18.4228 20.3128 18.639 19.9512 18.7156 19.5506C18.7922 19.15 18.7242 18.7357 18.5235 18.3792C18.3228 18.0227 18.002 17.7464 17.6164 17.5982ZM7.7707 19.2196C7.7707 19.3139 7.7423 19.4061 7.6891 19.4846C7.63589 19.563 7.56027 19.6241 7.47179 19.6602C7.38331 19.6963 7.28595 19.7057 7.19202 19.6873C7.09809 19.6689 7.01181 19.6235 6.94409 19.5568C6.87637 19.4901 6.83026 19.4052 6.81157 19.3127C6.79289 19.2202 6.80248 19.1243 6.83913 19.0371C6.87578 18.95 6.93784 18.8755 7.01747 18.8231C7.0971 18.7707 7.19072 18.7427 7.28649 18.7427C7.41491 18.7427 7.53807 18.793 7.62888 18.8824C7.71969 18.9718 7.7707 19.0931 7.7707 19.2196ZM17.455 19.2196C17.455 19.3139 17.4266 19.4061 17.3734 19.4846C17.3202 19.563 17.2446 19.6241 17.1561 19.6602C17.0676 19.6963 16.9703 19.7057 16.8763 19.6873C16.7824 19.6689 16.6961 19.6235 16.6284 19.5568C16.5607 19.4901 16.5146 19.4052 16.4959 19.3127C16.4772 19.2202 16.4868 19.1243 16.5234 19.0371C16.5601 18.95 16.6222 18.8755 16.7018 18.8231C16.7814 18.7707 16.875 18.7427 16.9708 18.7427C17.0992 18.7427 17.2224 18.793 17.3132 18.8824C17.404 18.9718 17.455 19.0931 17.455 19.2196ZM12.6667 19.2196C12.6667 19.3139 12.5845 19.4061 12.5313 19.4846C12.478 19.563 12.4024 19.6241 12.3139 19.6602C12.2255 19.6963 12.1281 19.7057 12.0342 19.6873C11.9402 19.6689 11.854 19.6235 11.7862 19.5568C11.7185 19.4901 11.6724 19.4052 11.6537 19.3127C11.635 19.2202 11.6446 19.1243 11.6813 19.0371C11.7179 18.95 11.78 18.8755 11.8596 18.8231C11.9393 18.7707 12.0329 18.7427 12.1286 18.7427C12.1966 18.7353 12.2654 18.742 12.3305 18.7626C12.3956 18.7832 12.4555 18.8172 12.5064 18.8622C12.5572 18.9073 12.5978 18.9624 12.6254 19.024C12.653 19.0856 12.6671 19.1523 12.6667 19.2196ZM10.8912 12.1723C10.8912 11.9313 10.9638 11.6957 11.0997 11.4953C11.2357 11.2948 11.429 11.1386 11.6551 11.0464C11.8812 10.9542 12.13 10.93 12.3701 10.977C12.6101 11.0241 12.8306 11.1401 13.0036 11.3106C13.1767 11.481 13.2946 11.6982 13.3423 11.9346C13.39 12.171 13.3655 12.416 13.2719 12.6387C13.1782 12.8614 13.0196 13.0517 12.8161 13.1856C12.6126 13.3196 12.3734 13.391 12.1286 13.391C11.8005 13.391 11.4857 13.2626 11.2536 13.0341C11.0216 12.8055 10.8912 12.4956 10.8912 12.1723Z" fill="currentColor"></path><path d="M17.186 6.41793C16.6248 5.24785 15.6925 4.2892 14.5297 3.68653C13.3669 3.08386 12.0367 2.86985 10.7397 3.07678C9.44262 3.2837 8.24903 3.90033 7.3389 4.8337C6.42877 5.76706 5.85143 6.96655 5.69395 8.25129C4.87515 8.4116 4.14676 8.86754 3.65175 9.5296C3.15675 10.1917 2.93088 11.012 3.01848 11.8297C3.10609 12.6473 3.50084 13.4032 4.12525 13.9489C4.74966 14.4947 5.55863 14.7908 6.39338 14.7793H6.5225C6.71941 14.7793 6.90826 14.7023 7.0475 14.5651C7.18674 14.428 7.26496 14.242 7.26496 14.0481C7.26496 13.8542 7.18674 13.6682 7.0475 13.531C6.90826 13.3939 6.71941 13.3169 6.5225 13.3169H6.39338C6.13629 13.3361 5.87794 13.3028 5.63452 13.2192C5.3911 13.1355 5.16785 13.0032 4.97876 12.8306C4.78967 12.6579 4.63882 12.4487 4.53565 12.216C4.43249 11.9833 4.37924 11.7321 4.37924 11.4782C4.37924 11.2243 4.43249 10.9731 4.53565 10.7404C4.63882 10.5077 4.78967 10.2985 4.97876 10.1258C5.16785 9.95323 5.3911 9.82094 5.63452 9.73726C5.87794 9.65358 6.13629 9.62032 6.39338 9.63955C6.58842 9.63677 6.77452 9.5585 6.91144 9.42167C7.04836 9.28484 7.1251 9.10044 7.12508 8.90833C7.153 7.8579 7.5521 6.84996 8.25361 6.05823C8.95511 5.2665 9.91507 4.74057 10.968 4.57108C12.021 4.40159 13.101 4.59916 14.022 5.12973C14.9429 5.66031 15.6471 6.49066 16.0131 7.47768C16.0689 7.62707 16.1726 7.75447 16.3085 7.84053C16.4445 7.9266 16.6052 7.96664 16.7664 7.95456H16.9278H16.9708C17.7053 7.94606 18.4132 8.22457 18.9396 8.72908C19.466 9.2336 19.7679 9.923 19.7792 10.6463C19.7814 11.2802 19.5623 11.8956 19.1588 12.3894C18.7553 12.8833 18.1918 13.2257 17.5626 13.3593C17.3888 13.4006 17.236 13.5022 17.1323 13.6456C17.0285 13.789 16.9807 13.9644 16.9977 14.1396C17.0147 14.3149 17.0954 14.4782 17.2249 14.5996C17.3543 14.721 17.5239 14.7924 17.7025 14.8005H17.8531C18.8172 14.5355 19.6573 13.9478 20.229 13.1386C20.8006 12.3294 21.068 11.3493 20.9852 10.3669C20.9024 9.38456 20.4746 8.46131 19.7753 7.75604C19.076 7.05077 18.149 6.60758 17.1537 6.50271L17.186 6.41793Z" fill="currentColor"></path></svg>';
                break;
            }
            if ((bookmark.url.includes("system-map"))) {
                img_src = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fit="" height="24px" width="24px" preserveAspectRatio="xMidYMid meet" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.3858 13.2289C17.0558 13.2289 17.5998 13.7739 17.5998 14.4429C17.5998 15.1129 17.0558 15.6579 16.3858 15.6579C15.7158 15.6579 15.1718 15.1129 15.1718 14.4429C15.1718 13.7739 15.7158 13.2289 16.3858 13.2289ZM13.7969 15.0629L9.05689 17.1399C8.71889 16.4579 8.11489 15.9579 7.38389 15.7559V10.2159C7.70089 10.1259 8.00389 9.97388 8.27489 9.76688L13.8579 13.5809C13.7629 13.8579 13.7139 14.1469 13.7139 14.4429C13.7139 14.6439 13.7409 14.8489 13.7969 15.0629ZM6.6719 6.42884C7.3419 6.42884 7.8859 6.97384 7.8859 7.64384C7.8859 8.31284 7.3419 8.85684 6.6719 8.85684C6.0019 8.85684 5.4569 8.31284 5.4569 7.64384C5.4569 6.97384 6.0019 6.42884 6.6719 6.42884ZM6.6719 19.5428C6.0019 19.5428 5.4569 18.9988 5.4569 18.3288C5.4569 17.6598 6.0019 17.1148 6.6719 17.1148C7.3419 17.1148 7.8859 17.6598 7.8859 18.3288C7.8859 18.9988 7.3419 19.5428 6.6719 19.5428ZM18.3278 5.45787C18.9978 5.45787 19.5428 6.00187 19.5428 6.67187C19.5428 7.34187 18.9978 7.88587 18.3278 7.88587C17.6588 7.88587 17.1148 7.34187 17.1148 6.67187C17.1148 6.00187 17.6588 5.45787 18.3278 5.45787ZM15.8009 7.512C16.1609 8.6 17.1719 9.343 18.3279 9.343C19.8019 9.343 20.9999 8.145 20.9999 6.672C20.9999 5.199 19.8019 4 18.3279 4C17.0809 4 16.0209 4.854 15.7379 6.055L9.10394 6.56C8.67694 5.603 7.72094 4.972 6.67194 4.972C5.19794 4.972 3.99994 6.17 3.99994 7.644C3.99994 8.832 4.79994 9.88 5.92694 10.208V15.765C4.79994 16.093 3.99994 17.141 3.99994 18.329C3.99994 19.802 5.19794 21 6.67194 21C8.03894 21 9.17394 19.964 9.31894 18.616L14.5169 16.337C15.0179 16.833 15.6899 17.115 16.3859 17.115C17.8599 17.115 19.0579 15.917 19.0579 14.443C19.0579 12.97 17.8599 11.772 16.3859 11.772C15.7659 11.772 15.1709 11.988 14.6909 12.385L9.15594 8.603C9.22994 8.411 9.28094 8.211 9.30794 8.006L15.8009 7.512Z" fill="currentColor"></path></svg>';
                break;
            }
        } while (false);

        // Create a div to hold the link and edit button
        const linkDiv = document.createElement('div');
        linkDiv.style = 'display: flex; align-items: center;'; // style to align items

        // Create link
        const editableLink = document.createElement('a');
        editableLink.id = `link-${bookmark.id}`; // ID to identify the link later
        editableLink.href = bookmark.url;
        editableLink.title = bookmark.url;
        editableLink.target = "_blank";
        editableLink.innerHTML = img_src + bookmark.shortName;

        // Create edit button
        // const editButton = document.createElement('button');
        // editButton.innerHTML = '&#9998;'; // Unicode for edit icon
        // editButton.style.border = 'none';

        // editButton.addEventListener('click', function () {
        //     const linkEditInput = document.createElement('input');
        //     linkEditInput.value = editableLink.textContent;
        //     linkEditInput.addEventListener('blur', updateLink);
        //     linkEditInput.addEventListener('keydown', function (event) {
        //         if (event.key === 'Enter') {
        //             updateLink();
        //         }
        //     });

        //     linkDiv.replaceChild(linkEditInput, editableLink);
        //     linkEditInput.focus();

        //     function updateLink() {
        //         const newLinkText = linkEditInput.value.trim();
        //         editableLink.textContent = newLinkText;
        //         bookmark.shortName = newLinkText;
        //         linkDiv.replaceChild(editableLink, linkEditInput);

        //         // Save the new link text to storage
        //         chrome.storage.sync.get({ bookmarks: [] }, function (result) {
        //             const bookmarks = result.bookmarks;
        //             const index = bookmarks.findIndex(b => b.id === bookmark.id);
        //             if (index > -1) {
        //                 bookmarks[index].shortName = newLinkText;
        //                 chrome.storage.sync.set({ bookmarks: bookmarks });
        //             }
        //         });
        //     }
        // });

        linkDiv.appendChild(editableLink);
        //linkDiv.appendChild(editButton);
        cell2.appendChild(linkDiv);

        const descDiv = document.createElement('div');
        descDiv.style = 'display: flex; align-items: center;'; // style to align items

        const descriptionText = document.createElement('span');
        descriptionText.id = `desc-${bookmark.id}`; // ID to identify the description later
        descriptionText.textContent = bookmark.description;

        const editButtonDesc = document.createElement('button');
        editButtonDesc.innerHTML = '&#9998;'; // Unicode for edit icon
        editButtonDesc.style.border = 'none';

        let updating = false;
        editButtonDesc.addEventListener('click', function () {
            const descEditInput = document.createElement('input');
            descEditInput.value = descriptionText.textContent;

            descEditInput.addEventListener('blur', function () {
                if (!updating) {
                    updating = true;
                    updateDescription();
                }
            });

            descEditInput.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevents form submission
                    if (!updating) {
                        updating = true;
                        updateDescription();
                    }
                }
            });

            descDiv.replaceChild(descEditInput, descriptionText);
            descEditInput.focus();

            function updateDescription() {
                const newDescText = descEditInput.value.trim();
                descriptionText.textContent = newDescText;
                bookmark.description = newDescText;
                descDiv.replaceChild(descriptionText, descEditInput);

                // Save the new description text to storage
                chrome.storage.sync.get({ bookmarks: [] }, function (result) {
                    const bookmarks = result.bookmarks;
                    const index = bookmarks.findIndex(b => b.id === bookmark.id);
                    if (index > -1) {
                        bookmarks[index].description = newDescText;
                        chrome.storage.sync.set({ bookmarks: bookmarks });
                    }
                });

                updating = false;
            }
        });

        descDiv.appendChild(descriptionText);
        descDiv.appendChild(editButtonDesc);
        cell3.appendChild(descDiv);

        // OPTIONS CELL

        // Create a div to contain the option tags
        var optionsDiv = document.createElement('div');

        // Create a tag for each option
        var searchParams = parsedUrl.searchParams;
        Array.from(searchParams).forEach(param => {

            let parameterValues = [];

            if (param[0] === "XXXXXXdistributionFilters") {
                try {
                    // Parse JSON value of "distributionFilters" into array
                    parameterValues = JSON.parse(param[1]);
                } catch (e) {
                    console.error("Failed to parse distributionFilters value", e);
                    return; // Continue to next iteration
                }
            } else {
                parameterValues = [param[1]];
            }

            parameterValues.forEach(value => {

                var optionTag = document.createElement('span');

                switch (param[0]) {
                    case "timespan":
                        optionTag.title = param[0]; // Show only the parameter name
                        optionTag.textContent = value; // Use the parameter value as a tooltip
                        break;
                    default:
                        optionTag.textContent = param[0]; // Show only the parameter name
                        optionTag.title = value; // Use the parameter value as a tooltip
                        break;
                }

                optionTag.style = 'background-color: #ddd; margin: 2px; padding: 2px; border-radius: 5px; border: 1px solid #000; margin: 5px; white-space: nowrap; padding: 5px;'; // Added padding

                // Add a delete button to the option tag
                var deleteButton = document.createElement('button');
                deleteButton.textContent = 'X';
                deleteButton.style = 'margin-left: 5px; background-color: red; color: white; border: none; border-radius: 2px; cursor: pointer;';

                deleteButton.onclick = function () {

                    if (param[0] === "XXXXdistributionFilters") {
                        var newFilterValues = JSON.parse(searchParams.get("distributionFilters")).filter(filterValue => filterValue !== value);

                        if (newFilterValues.length > 0) {
                            // Update the value in the URL's query string
                            searchParams.set("distributionFilters", JSON.stringify(newFilterValues));
                        } else {
                            // If no filter values are left, remove the parameter
                            searchParams.delete("distributionFilters");
                        }
                    } else {
                        // Remove the option from the URL's query string
                        searchParams.delete(param[0]);
                    }

                    // Get the original URL before updating it
                    var originalUrl = bookmark.url;

                    // Remove the option from the URL's query string
                    searchParams.delete(param[0]);
                    bookmark.url = parsedUrl.toString();
                    bookmark.searchParams = searchParams;

                    // Update the URL in the table
                    cell2.innerHTML = '<a href="' + bookmark.url + '" target="_blank">' + bookmark.description + '</a>';

                    // Remove the option tag
                    optionsDiv.removeChild(optionTag);

                    // Update the URL in the storage
                    chrome.storage.sync.get({ bookmarks: [] }, function (result) {
                        var bookmarks = result.bookmarks;
                        // Use the original URL to find the index of the bookmark
                        var index = bookmarks.findIndex(b => b.url === originalUrl);
                        if (index > -1) {
                            // Update the URL, then update the bookmark at the found index in the storage
                            bookmarks[index].url = bookmark.url;
                            chrome.storage.sync.set({ bookmarks: bookmarks });
                        }
                    });
                };

                optionTag.appendChild(deleteButton);

                optionsDiv.style = 'overflow: auto; padding: 5px;'; // Added padding to optionsDiv
                optionsDiv.appendChild(optionTag);

                // Attach delete event listener directly
                optionTag.addEventListener('click', function (event) {
                    var param = event.target.getAttribute('data-param');
                    deleteQueryParamAndOptionTag(event, param);
                });

            });

        });
        cell4.appendChild(optionsDiv);

        var actionDiv = document.createElement('div');
        actionDiv.style = 'display: flex; justify-content: space-between;';

        var deleteButton = document.createElement('button');
        deleteButton.innerHTML = '&#128465;';
        deleteButton.style.border = 'none';

        deleteButton.addEventListener('click', function () {
            deleteBookmarkFromStorage(bookmark, row);
        });

        actionDiv.appendChild(deleteButton);

        // var updateButton = document.createElement('button');
        // updateButton.innerHTML = '&#x1F589;'; // Unicode character for refresh icon
        // updateButton.addEventListener('click', function () {
        //     updateBookmarkFromPage(bookmark, row);
        // });
        // actionDiv.appendChild(updateButton);

        cell5.appendChild(actionDiv);
    }
}

// Usage example
// const bookmarkManager = new BookmarkManager('bookmarksTable');
// bookmarkManager.addBookmarkToTable(bookmark);
